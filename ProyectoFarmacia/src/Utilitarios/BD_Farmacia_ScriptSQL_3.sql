-- MySQL Script generated by MySQL Workbench
-- Mon Jun 26 23:35:56 2017
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema bd_Farmacia
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema bd_Farmacia
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `bd_Farmacia` DEFAULT CHARACTER SET utf8 ;
USE `bd_Farmacia` ;

-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_PROVEEDOR`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_PROVEEDOR` (
  `COD_PRV` CHAR(5) NOT NULL,
  `RAZ_SOC_PRV` VARCHAR(80) NOT NULL,
  `DIR_PRV` VARCHAR(100) NULL,
  `TLF_PRV` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`COD_PRV`))
ENGINE = InnoDB;

INSERT INTO tb_proveedor VALUES('PR001','Abbot ','Av. Isabel La Catolica 1875','4330895');
INSERT INTO tb_proveedor VALUES('PR002','Farmaval Peru s.a','Av. Lima 471','5380926');
INSERT INTO tb_proveedor VALUES('PR003','Tecnofarma s.a','Av. Venezuela 3018'    ,'2908165');
INSERT INTO tb_proveedor VALUES('PR004','Almafar s.a.c ','Av. Metropolitana 376'   ,'6542223');
INSERT INTO tb_proveedor VALUES('PR005','Bmc Farma ','Calle Las Dunas 245 '   ,'4780143');
INSERT INTO tb_proveedor VALUES('PR006','Sebal Farmacia s.a.c','Calle Pichincha 644 '   ,'5662848');
INSERT INTO tb_proveedor VALUES('PR007','Richer company ','Calle Las Perdices 225 Of. 204'  ,'4216184');
INSERT INTO tb_proveedor VALUES('PR008','Nexus Pharmaceutical ','Av. Los Frutales 564 '   ,'4364247');
INSERT INTO tb_proveedor VALUES('PR009','Dipropor s.a','Av. Del Aire 901'    ,'4742046');
INSERT INTO tb_proveedor VALUES('PR010','Miura s.a','Av. La Paz 257'    ,'4459710');

select * from tb_proveedor;

-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_CLIENTE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_CLIENTE` (
  `COD_CLI` CHAR(5) NOT NULL,
  `NOM_CLI` VARCHAR(30) NOT NULL,
  `APAT_CLI` VARCHAR(30) NOT NULL,
  `AMAT_CLI` VARCHAR(30) NOT NULL,
  `FEC_REG_CLI` DATE NOT NULL,
  `TLF_CLIENTE` CHAR(9) NULL,
  PRIMARY KEY (`COD_CLI`))
ENGINE = InnoDB;

INSERT INTO tb_cliente VALUES('C0001','Alicia','beltran','suarez','2008/10/12','934231843');
INSERT INTO tb_cliente VALUES('C0002','Emilio','pino','Beltran','2013/01/12','984406335');
INSERT INTO tb_cliente VALUES('C0003','Estrella','Laguna','Sol','2011/03/06','975012403');
INSERT INTO tb_cliente VALUES('C0004','Luis','morales','duares','2012/12/09','973725910');
INSERT INTO tb_cliente VALUES('C0005','Katia','ruiz','vasques','2013/01/10','994446177');
INSERT INTO tb_cliente VALUES('C0006','Judith','paredes','armando','2013/05/07','913810322');
INSERT INTO tb_cliente VALUES('C0007','Hector','chafloque','tirado','2012/02/10','925289034');
INSERT INTO tb_cliente VALUES('C0008','Intech','huaman','garcia','2011/07/01','922249493');

select * from tb_cliente;

-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_CARGO`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_CARGO` (
  `COD_CARGO` INT NOT NULL AUTO_INCREMENT,
  `DESC_CARGO` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`COD_CARGO`))
ENGINE = InnoDB;

insert into tb_cargo values(1,'cajero'),
							(2,'vendedor'),
                            (3,'administrador'),
                            (4,'almacenero');
select * from tb_cargo;
-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_EMPLEADO`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_EMPLEADO` (
  `COD_EMP` CHAR(5) NOT NULL,
  `NOM_EMP` VARCHAR(30) NOT NULL,
  `APAT_EMP` VARCHAR(30) NOT NULL,
  `AMAT_EMP` VARCHAR(30) NOT NULL,
  `FEC_NAC_EMP` DATE NOT NULL,
  `FEC_ING_EMP` DATE NOT NULL,
  `USER_EMP` VARCHAR(45) NOT NULL,
  `PASS_EMP` VARCHAR(45) NOT NULL,
  `COD_CARGO` INT NOT NULL,
  PRIMARY KEY (`COD_EMP`),
  INDEX `fk_Emp_Cargo_idx` (`COD_CARGO` ASC),
  CONSTRAINT `fk_Emp_Cargo`
    FOREIGN KEY (`COD_CARGO`)
    REFERENCES `bd_Farmacia`.`TB_CARGO` (`COD_CARGO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

INSERT INTO tb_empleado VALUES('E0001','JUANA','ALVA','SUASO','2003/07/02','2016/07/02','D08','123',1);
INSERT INTO tb_empleado VALUES('E0002','JUAN','SOTO','SOTO','2002/03/10','2015/07/02','D03','123',1);
INSERT INTO tb_empleado VALUES('E0003','CARLOS','AREVALO','ALVARADO','1992/10/02/','2006/07/02','D09','123',2);
INSERT INTO tb_empleado VALUES('E0004','CESAR','OJEDA','RUIZ','1999/11/08','2012/07/02','D01','123',2);
INSERT INTO tb_empleado VALUES('E0005','JULIO','VEGA','DENI','1997/05/11','2016/07/02','D02','123',3);
INSERT INTO tb_empleado VALUES('E0006','ANA','ORTEGA','CHUMPITAZ','1994/05/11','2017/07/02','D05','123',3);
INSERT INTO tb_empleado VALUES('E0007','JOSE','PALACIOS','CHORRI','1997/02/12','2013/07/02','D06','123',4);
INSERT INTO tb_empleado VALUES('E0008','RUBEN','GOMEZ','MULLER','1996/08/12','2013/07/02','D04','123',4);
INSERT INTO tb_empleado VALUES('E0009','PATRICIA','ARCE','BENIT','1997/05/12','2013/07/02','D07','123',3);
INSERT INTO tb_empleado VALUES('E0010','RENATO','PEREZ','LLANTO','1998/08/11','2013/07/02','D08','123');

select * from tb_empleado;

-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_LABORATORIO`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_LABORATORIO` (
  `COD_LAB` INT NOT NULL AUTO_INCREMENT,
  `DESC_LAB` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`COD_LAB`))
ENGINE = InnoDB;


INSERT INTO   tb_laboratorio VALUES(1,'Bayer');
INSERT INTO   tb_laboratorio VALUES(2,'Baxter');
INSERT INTO   tb_laboratorio VALUES(3,'Esel');
INSERT INTO   tb_laboratorio VALUES(4,'Lilly');
INSERT INTO   tb_laboratorio VALUES(5,'IqFarma');
INSERT INTO   tb_laboratorio VALUES(6,'TecnoFarma');
INSERT INTO   tb_laboratorio VALUES(7,'Nexus');

select * from tb_laboratorio;

-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_CATEGORIA`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_CATEGORIA` (
  `COD_CAT` INT NULL,
  `DESC_CAT` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`COD_CAT`))
ENGINE = InnoDB;


insert into tb_categoria values (01,'Analgesicos');
insert into tb_categoria values (02,'Antinflamatorios');
insert into tb_categoria values (03,'Aines');
insert into tb_categoria values (04,'Antibioticos');
insert into tb_categoria values (05,'Amoxicilna');
insert into tb_categoria values (06,'Cefalosporinas');
insert into tb_categoria values (07,'Eritromicina');
insert into tb_categoria values (08,'Quinolona');
insert into tb_categoria values (09,'Ampicilina');
insert into tb_categoria values (10,'Vancomicina');
insert into tb_categoria values (11,'Azitromicina');
insert into tb_categoria values (12,'Penicilinas');

select * from tb_categoria;
-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_PRODUCTO`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_PRODUCTO` (
  `COD_PRO` CHAR(5) NOT NULL,
  `DESC_PRO` VARCHAR(70) NOT NULL,
  `PRE_PRO` DECIMAL(10,2) NOT NULL,
  `STK_ACT` INT NOT NULL,
  `STK_MIN` INT NOT NULL,
  `UNI_MED` VARCHAR(20) NOT NULL,
  `FEC_VENC` DATE NOT NULL,
  `COD_LAB` INT NOT NULL,
  `COD_CAT` INT NOT NULL,
  PRIMARY KEY (`COD_PRO`),
  INDEX `fk_Pro_Lab_idx` (`COD_LAB` ASC),
  INDEX `fk_Pro_Cat_idx` (`COD_CAT` ASC),
  CONSTRAINT `fk_Pro_Lab`
    FOREIGN KEY (`COD_LAB`)
    REFERENCES `bd_Farmacia`.`TB_LABORATORIO` (`COD_LAB`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Pro_Cat`
    FOREIGN KEY (`COD_CAT`)
    REFERENCES `bd_Farmacia`.`TB_CATEGORIA` (`COD_CAT`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;



INSERT INTO TB_PRODUCTO VALUES  ('P0001','ASGESIC 10MG',2,80,10,'MILIGRAMO','18/05/21',1,1),
							    ('P0002','ASGESIC 20MG',3.5,95,10,'MILIGRAMO','18/05/21',2,2),
								('P0003','ASGESIC 30MG',5,74,10,'MILIGRAMO','18/05/21',3,2),
								('P0004','ASGESIC 60MG',8.5,65,10,'MILIGRAMO','18/05/21',4,3),
								('P0005','DOLALGIAL',3,76,10,'MILIGRAMO','18/05/21',5,5),
								('P0006','NACLODIL',5,43,10,'MILIGRAMO','18/05/21',6,3),
								('P0007','DOLOSTOP 20MG',600,54,10,'MILIGRAMO','18/05/21',7,5),
								('P0008','ASPIRINA',1,99,10,'MILIGRAMO','18/05/21',1,7),
								('P0009','CAFIASPIRINA',1,65,10,'MILIGRAMO','18/05/21',2,4),
								('P0010','DOLPIRET CMP',2,54,10,'MILIGRAMO','18/05/21',3,6),
                                ('P0011','DOLPIRET SSP',3,64,10,'MILIGRAMO','18/05/21',4,6),
								('P0012','DONTOFLAMON CMP',2.5,13,10,'MILIGRAMO','18/05/21',5,8),
								('P0013','DONTOFLAMON SSP',3.5,65,10,'MILIGRAMO','18/05/21',6,9),
								('P0014','IBUFLAMAR',6.5,75,10,'MILIGRAMO','18/05/21',7,9),
								('P0015','PIREDOL',5,48,10,'MILIGRAMO','18/05/21',1,9),
								('P0016','FLAMADIN',3,46,2,'MILIGRAMO','18/05/21',2,9),
								('P0017','DIPROFEN CMP',6,84,10,'MILIGRAMO','18/05/21',3,6),
								('P0018','DIPROFEN SSP',7.5,46,10,'MILIGRAMO','18/05/21',4,6),
								('P0019','IBUPRONAL FORTE',10,64,10,'MILIGRAMO','18/05/21',5,3),
								('P0020','CEFLEX 200MG',4.5,76,10,'MILIGRAMO','18/05/21',6,9);
                                
select * from tb_producto;


-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_VENTA`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_VENTA` (
  `NUM_VENTA` INT NOT NULL AUTO_INCREMENT,
  `FEC_VENTA` DATE NOT NULL,
  `EST_VENTA` SMALLINT NOT NULL,
  `COD_CLI` CHAR(5) NOT NULL,
  `COD_EMP` CHAR(5) NOT NULL,
  PRIMARY KEY (`NUM_VENTA`),
  INDEX `fk_Venta_Cliente_idx` (`COD_CLI` ASC),
  INDEX `fk_Venta_Emp_idx` (`COD_EMP` ASC),
  CONSTRAINT `fk_Venta_Cliente`
    FOREIGN KEY (`COD_CLI`)
    REFERENCES `bd_Farmacia`.`TB_CLIENTE` (`COD_CLI`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Venta_Emp`
    FOREIGN KEY (`COD_EMP`)
    REFERENCES `bd_Farmacia`.`TB_EMPLEADO` (`COD_EMP`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_DETALLE_VENTA`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_DETALLE_VENTA` (
  `COD_VENTA` INT NOT NULL,
  `COD_PRO` CHAR(5) NOT NULL,
  `CANT_VENTA` INT NOT NULL,
  `PREC_VEN` DECIMAL(10,2) NOT NULL,
  PRIMARY KEY (`COD_VENTA`, `COD_PRO`),
  INDEX `fk_DetVenta_Pro_idx` (`COD_PRO` ASC),
  CONSTRAINT `fk_DetVenta_Venta`
    FOREIGN KEY (`COD_VENTA`)
    REFERENCES `bd_Farmacia`.`TB_VENTA` (`NUM_VENTA`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DetVenta_Pro`
    FOREIGN KEY (`COD_PRO`)
    REFERENCES `bd_Farmacia`.`TB_PRODUCTO` (`COD_PRO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_ORDEN_COMPRA`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_ORDEN_COMPRA` (
  `COD_OCOM` CHAR(5) NOT NULL,
  `FEC_OCOM` DATE NOT NULL,
  `EST_OCOM` INT NOT NULL,
  `COD_PRV` CHAR(5) NOT NULL,
  PRIMARY KEY (`COD_OCOM`),
  INDEX `fk_OCom_Prv_idx` (`COD_PRV` ASC),
  CONSTRAINT `fk_OCom_Prv`
    FOREIGN KEY (`COD_PRV`)
    REFERENCES `bd_Farmacia`.`TB_PROVEEDOR` (`COD_PRV`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bd_Farmacia`.`TB_DETALLE_OCOMPRA`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_Farmacia`.`TB_DETALLE_OCOMPRA` (
  `COD_OCOM` CHAR(5) NOT NULL,
  `COD_PRO` CHAR(5) NOT NULL,
  `CANT_PED` INT NOT NULL,
  PRIMARY KEY (`COD_OCOM`, `COD_PRO`),
  INDEX `fk_DetComp_Pro_idx` (`COD_PRO` ASC),
  CONSTRAINT `fk_DetComp_OCom`
    FOREIGN KEY (`COD_OCOM`)
    REFERENCES `bd_Farmacia`.`TB_ORDEN_COMPRA` (`COD_OCOM`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_DetComp_Pro`
    FOREIGN KEY (`COD_PRO`)
    REFERENCES `bd_Farmacia`.`TB_PRODUCTO` (`COD_PRO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- SET SQL_MODE=@OLD_SQL_MODE;
-- SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
-- SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;


-- -----------------------------------------------------
-- PROCEDIMIENTOS ALMACENADOS: CLIENTE
-- -----------------------------------------------------

-- PROCEDIMIENTO PARA LISTAR CLIENTES
DROP PROCEDURE IF EXISTS ListarCliente;
DELIMITER @@
CREATE PROCEDURE ListarCliente()
BEGIN
	SELECT * FROM TB_CLIENTE;
END  @@
DELIMITER ;

-- PROCEDIMIENTO PARA BUSCAR UN CLIENTE
DROP PROCEDURE IF EXISTS BuscarCliente;
DELIMITER @@
CREATE PROCEDURE BuscarCliente(ID CHAR(5))
BEGIN
	SELECT * FROM TB_CLIENTE WHERE COD_CLI = ID;
END @@
DELIMITER ;

-- PROCEDIMIENTO PARA INSERTAR UN CLIENTE
DROP PROCEDURE IF EXISTS InsertarCliente;
DELIMITER @@
CREATE PROCEDURE InsertarCliente(COD_CLI CHAR(5), NOM_CLI VARCHAR(30), APAT_CLI VARCHAR(30), AMAT_CLI VARCHAR(30), FEC_REG_CLI DATE, TLF_CLIENTE CHAR(9))
BEGIN
	INSERT TB_CLIENTE VALUES(COD_CLI, NOM_CLI, APAT_CLI, AMAT_CLI, FEC_REG_CLI, TLF_CLIENTE);
END @@
DELIMITER ;

-- PROCEDIMIENTO PARA MODIFICAR CLIENTE
DROP PROCEDURE IF EXISTS ModificarCliente;
DELIMITER @@
CREATE PROCEDURE ModificarCliente(XCOD_CLI CHAR(5), XNOM_CLI VARCHAR(30), XAPAT_CLI VARCHAR(30), XAMAT_CLI VARCHAR(30), XFEC_REG_CLI DATE, XTLF_CLIENTE CHAR(9))
BEGIN
	UPDATE TB_CLIENTE SET NOM_CLI=XNOM_CLI, APAT_CLI=XAPAT_CLI, AMAT_CLI=XAMAT_CLI, FEC_REG_CLI=XFEC_REG_CLI, TLF_CLIENTE=XTLF_CLIENTE WHERE COD_CLI = XCOD_CLI;
END @@
DELIMITER ;

-- PROCEDIMIENTO PARA ELIMINAR FILAS
DROP PROCEDURE IF EXISTS EliminarCliente;
DELIMITER @@
CREATE PROCEDURE EliminarCliente(ID CHAR(5))
BEGIN
	DELETE FROM TB_CLIENTE WHERE COD_CLI=ID;
END @@
DELIMITER ;

